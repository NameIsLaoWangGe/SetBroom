{
  "code": "export default class Hand extends Laya.Script3D {\r\n    constructor() {\r\n        super();\r\n        this.compoundShape = new Laya.CompoundColliderShape();\r\n        this.connectSWicth = false;\r\n        this.longest = 0.35;\r\n        this.shortest = 0.25;\r\n    }\r\n    onEnable() {\r\n        this.self = this.owner;\r\n        this.selfScene = this.self.scene;\r\n        this.besom = this.selfScene.getChildAt(5);\r\n        this.selfRig = this.self.getComponent(Laya.Rigidbody3D);\r\n        this.palm = this.self.getChildAt(1);\r\n        this.palmLPx = this.palm.transform.localPositionX;\r\n        this.palmLPy = this.palm.transform.localPositionY;\r\n        this.palmLPz = this.palm.transform.localPositionZ;\r\n        this.firstLPx = this.self.transform.localPositionX;\r\n        this.firstLPy = this.self.transform.localPositionY;\r\n        this.firstLPz = this.self.transform.localPositionZ;\r\n        let firstLREx = this.self.transform.localRotationEulerX;\r\n        let firstLREy = this.self.transform.localRotationEulerY;\r\n        let firstLREz = this.self.transform.localRotationEulerZ;\r\n        this.firstLRE = new Laya.Vector3(firstLREx, firstLREy, firstLREz);\r\n        this.lopState = true;\r\n        this.self['UIMain_Hand'] = this;\r\n        this.combinatcollision();\r\n        this.handParameters();\r\n    }\r\n    firstState() {\r\n        this.self.transform.localPositionX = this.firstLPx;\r\n        this.self.transform.localPositionY = this.firstLPy;\r\n        this.self.transform.localPositionZ = this.firstLPz;\r\n        this.self.transform.localRotationEuler = this.firstLRE;\r\n        let e = this.palm.transform.localRotationEuler.clone();\r\n        e.x = 0;\r\n        e.y = 0;\r\n        e.z = 0;\r\n        this.palm.transform.localRotationEuler = e;\r\n        this.palm.transform.localPositionX = this.palmLPx;\r\n        this.palm.transform.localPositionY = this.palmLPy;\r\n        this.palm.transform.localPositionZ = this.palmLPz;\r\n        this.selfScene['UIMain'].person['UIMain_Person'].originalState();\r\n        this.lopState = true;\r\n    }\r\n    combinatcollision() {\r\n        let handCollider = this.self.getChildAt(0);\r\n        let collider = handCollider.getComponent(Laya.PhysicsCollider);\r\n        let handShape = collider.colliderShape.clone();\r\n        collider.destroy();\r\n        this.compoundShape.addChildShape(handShape);\r\n        this.selfRig.colliderShape = this.compoundShape;\r\n    }\r\n    handParameters() {\r\n        this.selfRig.isKinematic = true;\r\n        this.selfRig.restitution = 0;\r\n        this.selfRig.friction = 100;\r\n        this.selfRig.gravity = (new Laya.Vector3(0, 0, 0));\r\n        this.selfRig.mass = 200;\r\n    }\r\n    onCollisionEnter() {\r\n        if (!this.besomHandleLen) {\r\n            this.besomHandleLen = this.besomHandLenCount();\r\n        }\r\n        this.presentHand = this.self.name;\r\n        this.connectSWicth = true;\r\n        this.selfScene['UIMain'].connectionNum = 1;\r\n    }\r\n    besomHandLenCount() {\r\n        let besomVec = this.besom.transform.localPosition;\r\n        let handVec = this.self.transform.localPosition;\r\n        let p = new Laya.Vector3();\r\n        Laya.Vector3.subtract(besomVec, handVec, p);\r\n        let lenp = Laya.Vector3.scalarLength(p);\r\n        return lenp;\r\n    }\r\n    besomPedestalHandLenCount() {\r\n        let besomPedestal = this.besom.getChildAt(2);\r\n        let besomPedestalVec = besomPedestal.transform.position;\r\n        let handVec = this.self.transform.position;\r\n        let p = new Laya.Vector3();\r\n        Laya.Vector3.subtract(besomPedestalVec, handVec, p);\r\n        let lenp = Laya.Vector3.scalarLength(p);\r\n        return lenp;\r\n    }\r\n    bottomPosition() {\r\n        if (!this.besomHandleLen) {\r\n            return;\r\n        }\r\n        let l_01 = this.besomHandleLen;\r\n        let l_02 = Math.abs(this.besom.transform.localPositionY - this.self.transform.localPositionY);\r\n        let l_03;\r\n        if (Math.pow(l_01, 2) - Math.pow(l_02, 2) < 0) {\r\n            l_03 = 0;\r\n        }\r\n        else {\r\n            l_03 = Math.sqrt(Math.pow(l_01, 2) - Math.pow(l_02, 2));\r\n        }\r\n        let besomBottomX;\r\n        if (this.besom.transform.localRotationEulerX > 0) {\r\n            besomBottomX = this.besom.transform.localPositionX + l_03;\r\n        }\r\n        else {\r\n            besomBottomX = this.besom.transform.localPositionX - l_03;\r\n        }\r\n        let offsetX = this.self.transform.localPositionX - besomBottomX;\r\n        this.besom.transform.localPositionX += offsetX;\r\n        return offsetX;\r\n    }\r\n    armLookAtHand() {\r\n        let handVec = this.self.transform.localPosition;\r\n        let leftArm = this.selfScene['UIMain'].person['UIMain_Person'].leftArm;\r\n        if (this.self.name === 'leftHand') {\r\n            leftArm.transform.lookAt(handVec, new Laya.Vector3(0, 1, 0));\r\n            this.armDirection(leftArm);\r\n            let armVec = leftArm.transform.position;\r\n            this.palm.transform.lookAt(armVec, new Laya.Vector3(0, 1, 0));\r\n            this.palmDirection();\r\n            this.handDistance(armVec, handVec);\r\n        }\r\n        let rightArm = this.selfScene['UIMain'].person['UIMain_Person'].rightArm;\r\n        if (this.self.name === 'rightHand') {\r\n            rightArm.transform.lookAt(handVec, new Laya.Vector3(0, 1, 0));\r\n            this.armDirection(rightArm);\r\n            let armVec = rightArm.transform.position;\r\n            this.palm.transform.lookAt(armVec, new Laya.Vector3(0, 1, 0));\r\n            this.palmDirection();\r\n            this.handDistance(armVec, handVec);\r\n        }\r\n    }\r\n    armDirection(arm) {\r\n        let e = arm.transform.localRotationEuler.clone();\r\n        let x = e.x;\r\n        let y = e.y;\r\n        let z = e.z;\r\n        if (arm.name === 'rightArm') {\r\n            e.x = x + 85;\r\n            e.y = y + 19;\r\n            e.z = z + 30;\r\n        }\r\n        else {\r\n            e.x = x + 85;\r\n            e.y = y - 15;\r\n            e.z = z - 26;\r\n        }\r\n        arm.transform.localRotationEuler = e;\r\n    }\r\n    palmDirection() {\r\n        let e = this.palm.transform.localRotationEuler.clone();\r\n        let x = e.x;\r\n        let y = e.y;\r\n        let z = e.z;\r\n        if (this.self.name === 'rightHand') {\r\n            e.x = x + 90;\r\n            e.y = y;\r\n            e.z = z - 160;\r\n        }\r\n        else {\r\n            e.x = x + 90;\r\n            e.y = y;\r\n            e.z = z + 168;\r\n        }\r\n        this.palm.transform.localRotationEuler = e;\r\n    }\r\n    handDistance(armVec, handVec) {\r\n        let p = new Laya.Vector3();\r\n        Laya.Vector3.subtract(handVec, armVec, p);\r\n        let lenP = Laya.Vector3.scalarLength(p);\r\n        let normalizP = new Laya.Vector3();\r\n        Laya.Vector3.normalize(p, normalizP);\r\n        if (lenP > this.longest) {\r\n            let x = armVec.x + normalizP.x * this.longest;\r\n            let y = armVec.y + normalizP.y * this.longest;\r\n            let z = armVec.z + normalizP.z * this.longest;\r\n            this.self.transform.localPositionX = x;\r\n            this.self.transform.localPositionY = y;\r\n        }\r\n        let moveL;\r\n        moveL = (lenP / this.longest) * (this.longest - this.shortest);\r\n        if (this.self.name === 'rightHand') {\r\n            let rightUnder = this.selfScene['UIMain'].person['UIMain_Person'].rightUnder;\r\n            let rightUnderArmY = this.selfScene['UIMain'].person['UIMain_Person'].rightUnderArmY;\r\n            let rightUnderArmX = this.selfScene['UIMain'].person['UIMain_Person'].rightUnderArmX;\r\n            rightUnder.transform.localPositionY = rightUnderArmY - moveL * 50;\r\n            rightUnder.transform.localPositionX = rightUnderArmX - 1.5;\r\n        }\r\n        else {\r\n            let leftUnder = this.selfScene['UIMain'].person['UIMain_Person'].leftUnder;\r\n            let leftUnderArmY = this.selfScene['UIMain'].person['UIMain_Person'].leftUnderArmY;\r\n            let leftUnderArmX = this.selfScene['UIMain'].person['UIMain_Person'].leftUnderArmX;\r\n            leftUnder.transform.localPositionY = leftUnderArmY - moveL * 50;\r\n            leftUnder.transform.localPositionX = leftUnderArmX + 1.5;\r\n        }\r\n    }\r\n    onUpdate() {\r\n        if (this.connectSWicth && this.presentHand === this.self.name && this.selfScene['UIMain'].connectionNum) {\r\n            let besomPedestalHandLen = this.besomPedestalHandLenCount();\r\n            let bhl = this.besomHandLenCount();\r\n            if (Math.abs(bhl - this.besomHandleLen) > 0.05) {\r\n                this.connectSWicth = false;\r\n                this.besomHandleLen = null;\r\n                this.presentHand = null;\r\n                this.besom['UIMain_Besom'].rigParameters();\r\n                console.log('离开手！');\r\n            }\r\n            else {\r\n            }\r\n        }\r\n        if (!this.lopState) {\r\n            this.armLookAtHand();\r\n        }\r\n    }\r\n    onDisable() {\r\n    }\r\n}\r\n",
  "references": [
    "D:/Game/project/SetBroom/Setbroom/src/script/Game/UIMain_Person.ts"
  ]
}
