{
  "code": "import { lwg } from \"../Lwg_Template/lwg\";\r\nexport default class UIPifu extends Laya.Script {\r\n    constructor() {\r\n        super();\r\n        this.moveSwitch = false;\r\n        this.listFirstIndex = lwg.Enum.PifuAllName[lwg.Global._currentPifu];\r\n        this.noHaveIndex = 0;\r\n    }\r\n    onEnable() {\r\n        this.self = this.owner;\r\n        this.BtnBack = this.self['BtnBack'];\r\n        this.BtnBuy = this.self['BtnBuy'];\r\n        this.BtnSelect = this.self['BtnSelect'];\r\n        this.PifuParent = this.self['PifuParent'];\r\n        this.PifuList = this.self['PifuList'];\r\n        this.PifuName = this.self['PifuName'];\r\n        this.GoldRes = this.self['GoldRes'];\r\n        this.PifuNum = this.self['PifuNum'];\r\n        this.background = this.self['background'];\r\n        this.noHaveSubChaoren();\r\n        this.btnClickOn();\r\n        this.createPifuList();\r\n        this.goldRes();\r\n        this.pifuNum();\r\n        this.priceDisplay();\r\n        this.adaptive();\r\n        this.openAni();\r\n    }\r\n    priceDisplay() {\r\n        let price = 250 * lwg.Global._buyNum - 150;\r\n        let num = this.BtnBuy.getChildByName('Num');\r\n        num.text = price.toString();\r\n    }\r\n    goldRes() {\r\n        let goldLebel = this.GoldRes.getChildByName('Num');\r\n        goldLebel.text = (lwg.Global._goldNum).toString();\r\n    }\r\n    pifuNum() {\r\n        let pifuNumLebel = this.PifuNum.getChildByName('Num');\r\n        pifuNumLebel.text = lwg.Global._havePifu.length + '/' + lwg.Global._allPifu.length;\r\n    }\r\n    noHaveSubChaoren() {\r\n        let allArray = [];\r\n        for (let i = 0; i < lwg.Global._allPifu.length; i++) {\r\n            const element = lwg.Global._allPifu[i];\r\n            allArray.push(element);\r\n        }\r\n        for (let j = 0; j < allArray.length; j++) {\r\n            let element1 = allArray[j];\r\n            for (let k = 0; k < lwg.Global._havePifu.length; k++) {\r\n                let element2 = lwg.Global._havePifu[k];\r\n                if (element1 === element2) {\r\n                    allArray.splice(j, 1);\r\n                    j--;\r\n                }\r\n            }\r\n        }\r\n        lwg.Global._notHavePifu = allArray;\r\n        for (let k = 0; k < allArray.length; k++) {\r\n            const element = allArray[k];\r\n            if (element === '09_chaoren') {\r\n                allArray.splice(k, 1);\r\n            }\r\n            lwg.Global._notHavePifuSubChaoren = allArray;\r\n            console.log(lwg.Global._notHavePifuSubChaoren);\r\n        }\r\n    }\r\n    adaptive() {\r\n        this.self['TowBtn'].y = Laya.stage.height * 0.822;\r\n        this.PifuList.y = Laya.stage.height * 0.534;\r\n        this.PifuName.y = Laya.stage.height * 0.264;\r\n        this.self['P201'].y = Laya.stage.height * 0.18671875;\r\n        this.BtnBack.y = 150;\r\n    }\r\n    openAni() {\r\n        let delayed = 100;\r\n        let time = 200;\r\n        let y2 = this.background.y;\r\n        lwg.Animation.move_Deform_Y(this.background, -300, -15, y2, -0.1, 0.2, time, delayed * 1, f => {\r\n        });\r\n        let x1 = this.BtnBack.x;\r\n        lwg.Animation.move_Deform_X(this.BtnBack, -200, 30, x1, -0.1, 0.2, time, delayed * 4, f => { });\r\n        let x2 = this.GoldRes.x;\r\n        lwg.Animation.move_Deform_X(this.GoldRes, 920, 30, x2, 0.2, -0.15, time, delayed * 3, f => { });\r\n        let x3 = this.PifuName.x;\r\n        lwg.Animation.move_Deform_X(this.PifuName, x3, 0, x3, 0.2, -0.15, time, delayed * 4, f => { });\r\n        let x4 = this.BtnBuy.x;\r\n        lwg.Animation.move_Deform_X(this.BtnBuy, x4, 0, x4, 0.2, -0.15, time, delayed * 4, f => { });\r\n        let x5 = this.BtnSelect.x;\r\n        lwg.Animation.move_Deform_X(this.BtnSelect, x5, 0, x5, 0.2, -0.15, time, delayed * 4, f => { });\r\n        let y1 = this.PifuNum.y;\r\n        lwg.Animation.move_Deform_Y(this.PifuNum, -300, -15, y1, -0.1, 0.2, time, delayed * 2, f => {\r\n        });\r\n        lwg.Animation.fadeOut(this.PifuList, 0, 1, time, delayed, f => {\r\n            this.listOpenAni();\r\n        });\r\n    }\r\n    createPifuList() {\r\n        this.PifuList.hScrollBarSkin = \"\";\r\n        this.PifuList.selectHandler = new Laya.Handler(this, this.onSelect_List);\r\n        this.PifuList.renderHandler = new Laya.Handler(this, this.updateItem);\r\n        this.refreshListData();\r\n        this.pifuNameRefresh();\r\n    }\r\n    listOpenAni() {\r\n        if (0 <= this.listFirstIndex && this.listFirstIndex <= 4) {\r\n            this.PifuList.scrollTo(this.PifuList.length - 1);\r\n        }\r\n        else {\r\n            this.PifuList.scrollTo(0);\r\n        }\r\n        this.PifuList.tweenTo(this.listFirstIndex, 600);\r\n    }\r\n    refreshListData() {\r\n        var data = [];\r\n        for (var m = -1; m < 10; m++) {\r\n            if (m === -1 || m === 9) {\r\n                data.push({\r\n                    stance: true\r\n                });\r\n                continue;\r\n            }\r\n            let name = lwg.Global._allPifu[m];\r\n            let have = false;\r\n            for (let index = 0; index < lwg.Global._havePifu.length; index++) {\r\n                const element = lwg.Global._havePifu[index];\r\n                if (lwg.Global._allPifu[m] === lwg.Global._havePifu[index]) {\r\n                    have = true;\r\n                }\r\n            }\r\n            let pifuUrl;\r\n            let lock;\r\n            if (have) {\r\n                pifuUrl = lwg.Enum.PifuSkin[m];\r\n                lock = false;\r\n            }\r\n            else {\r\n                pifuUrl = lwg.Enum.PifuSkin_No[m];\r\n                lock = true;\r\n            }\r\n            let select;\r\n            if (lwg.Global._currentPifu === lwg.Enum.PifuAllName[m]) {\r\n                select = true;\r\n            }\r\n            else {\r\n                select = false;\r\n            }\r\n            let shadowUrl = 'pifu/ui_shadow.png';\r\n            let scale;\r\n            if (m === this.listFirstIndex) {\r\n                scale = 1;\r\n            }\r\n            else {\r\n                scale = 0.8;\r\n            }\r\n            data.push({\r\n                name,\r\n                have,\r\n                pifuUrl,\r\n                lock,\r\n                select,\r\n                shadowUrl,\r\n                scale\r\n            });\r\n        }\r\n        this.PifuList.array = data;\r\n    }\r\n    onSelect_List(index) {\r\n    }\r\n    updateItem(cell, index) {\r\n        let dataSource = cell.dataSource;\r\n        let pifuImg = cell.getChildByName('PifuImg');\r\n        let lock = cell.getChildByName('Lock');\r\n        let select = cell.getChildByName('Select');\r\n        let shadow = cell.getChildByName('Shadow');\r\n        cell.name = dataSource.name;\r\n        pifuImg.skin = dataSource.pifuUrl;\r\n        lock.visible = dataSource.lock;\r\n        select.visible = dataSource.select;\r\n        shadow.skin = dataSource.shadowUrl;\r\n        cell.scale(dataSource.scale, dataSource.scale);\r\n    }\r\n    onStageMouseDown() {\r\n        this.firstX = Laya.MouseManager.instance.mouseX;\r\n        this.moveSwitch = true;\r\n    }\r\n    onStageMouseUp() {\r\n        let x = Laya.MouseManager.instance.mouseX;\r\n        if (!this.moveSwitch) {\r\n            return;\r\n        }\r\n        let diffX = x - this.firstX;\r\n        if (diffX > 100) {\r\n            this.listFirstIndex -= 1;\r\n            if (this.listFirstIndex < 0) {\r\n                this.listFirstIndex = 0;\r\n            }\r\n        }\r\n        else if (diffX < -100) {\r\n            this.listFirstIndex += 1;\r\n            if (this.listFirstIndex > 8) {\r\n                this.listFirstIndex = 8;\r\n            }\r\n        }\r\n        this.moveSwitch = false;\r\n        this.PifuList.tweenTo(this.listFirstIndex, 100, Laya.Handler.create(this, this.moveCompelet));\r\n    }\r\n    moveCompelet() {\r\n        this.pifuNameRefresh();\r\n        this.refreshListData();\r\n        this.whetherHaveThisPifu();\r\n    }\r\n    pifuNameRefresh() {\r\n        let name = this.PifuName.getChildAt(0);\r\n        let num = this.listFirstIndex;\r\n        if (lwg.Enum.PifuAllName[num]) {\r\n            name.text = lwg.Enum.PifuAllName_Ch[num];\r\n        }\r\n    }\r\n    whetherHaveThisPifu() {\r\n        let cell = this.PifuList.getCell(this.listFirstIndex + 1);\r\n        let boo = false;\r\n        for (let index = 0; index < lwg.Global._havePifu.length; index++) {\r\n            const pifuName = lwg.Global._havePifu[index];\r\n            if (cell.name === pifuName) {\r\n                boo = true;\r\n            }\r\n        }\r\n        if (boo) {\r\n            this.showSelect = true;\r\n            this.BtnSelect.skin = 'pifu/select_btn1.png';\r\n        }\r\n        else {\r\n            this.showSelect = false;\r\n            this.BtnSelect.skin = 'pifu/select_btn2.png';\r\n        }\r\n    }\r\n    btnClickOn() {\r\n        lwg.Click.on('largen', null, this.BtnBack, this, null, null, this.btnBackClickUP, null);\r\n        lwg.Click.on('largen', null, this.BtnBuy, this, null, null, this.btnBuyClickUP, null);\r\n        lwg.Click.on('largen', null, this.BtnSelect, this, null, null, this.btnSelectClickUP, null);\r\n    }\r\n    btnBackClickUP(event) {\r\n        event.stopPropagation();\r\n        event.currentTarget.scale(1, 1);\r\n        this.self.close();\r\n        lwg.Global.UIMain['UIMain'].currentPifuSet();\r\n        lwg.Global.UIStart['UIStart'].goldRes();\r\n        lwg.LocalStorage.addData();\r\n    }\r\n    btnBuyClickUP(event) {\r\n        event.currentTarget.scale(1, 1);\r\n        event.stopPropagation();\r\n        let price = 250 * lwg.Global._buyNum - 150;\r\n        if (lwg.Global._goldNum < price || lwg.Global._notHavePifuSubChaoren.length <= 0) {\r\n            if (lwg.Global._goldNum < price) {\r\n                lwg.Global._createHint_01(lwg.Enum.HintType.noGold);\r\n            }\r\n            else if (lwg.Global._notHavePifuSubChaoren.length <= 0) {\r\n                lwg.Global._createHint_01(lwg.Enum.HintType.noPifu);\r\n            }\r\n            return;\r\n        }\r\n        else {\r\n            lwg.Global._goldNum -= price;\r\n            lwg.Global._buyNum++;\r\n            this.goldRes();\r\n            let random = Math.floor(Math.random() * lwg.Global._notHavePifuSubChaoren.length);\r\n            this.buyIndex = lwg.Enum.PifuAllName[lwg.Global._notHavePifuSubChaoren[random]];\r\n            console.log('购买了第' + this.buyIndex + '位置的皮肤');\r\n            this.nohavePifuAni();\r\n        }\r\n    }\r\n    nohavePifuAni() {\r\n        let noHavePifu_00 = lwg.Global._notHavePifuSubChaoren[this.noHaveIndex];\r\n        console.log(noHavePifu_00);\r\n        let index;\r\n        if (noHavePifu_00) {\r\n            index = lwg.Enum.PifuAllName[noHavePifu_00];\r\n            this.listFirstIndex = index;\r\n            this.refreshListData();\r\n            this.pifuNameRefresh();\r\n            this.PifuList.tweenTo(index, 200, Laya.Handler.create(this, function () {\r\n                this.noHaveIndex++;\r\n                this.nohavePifuAni();\r\n                this.pifuNameRefresh();\r\n            }));\r\n        }\r\n        else {\r\n            console.log('循环完毕，准备循环到被购买的那个皮肤', this.buyIndex);\r\n            let time = this.buyIndex;\r\n            this.PifuList.tweenTo(this.buyIndex, (11 - this.buyIndex) * 100, Laya.Handler.create(this, function () {\r\n                this.noHaveIndex = 0;\r\n                this.listFirstIndex = this.buyIndex;\r\n                this.buyCompelet();\r\n            }));\r\n        }\r\n    }\r\n    buyCompelet() {\r\n        lwg.Global._havePifu.push(lwg.Enum.PifuAllName[this.buyIndex]);\r\n        this.noHaveSubChaoren();\r\n        this.pifuNum();\r\n        this.pifuNameRefresh();\r\n        this.refreshListData();\r\n        this.whetherHaveThisPifu();\r\n        this.priceDisplay();\r\n        lwg.LocalStorage.addData();\r\n        console.log('购买完成！');\r\n    }\r\n    btnSelectClickUP(event) {\r\n        event.currentTarget.scale(1, 1);\r\n        event.stopPropagation();\r\n        let cell = this.PifuList.getCell(this.listFirstIndex + 1);\r\n        let lock = cell.getChildByName('Lock');\r\n        if (this.showSelect) {\r\n            if (!lock.visible) {\r\n                let select1 = cell.getChildByName('Select');\r\n                select1.visible = false;\r\n                lwg.Global._currentPifu = lwg.Global._allPifu[this.listFirstIndex];\r\n                this.refreshListData();\r\n            }\r\n        }\r\n    }\r\n    onDisable() {\r\n    }\r\n}\r\n",
  "references": [
    "D:/Game/project/SetBroom/obj/Setbroom/src/script/Lwg_Template/lwg.ts"
  ]
}
