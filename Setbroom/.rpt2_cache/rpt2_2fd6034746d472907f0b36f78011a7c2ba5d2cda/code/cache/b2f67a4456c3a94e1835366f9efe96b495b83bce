{
  "code": "import { lwg } from '../Lwg_Template/lwg';\r\nexport default class Hand extends Laya.Script3D {\r\n    constructor() {\r\n        super();\r\n        this.compoundShape = new Laya.CompoundColliderShape();\r\n        this.longest = 0.375;\r\n        this.shortest = 0.21;\r\n    }\r\n    onEnable() {\r\n        this.self = this.owner;\r\n        this.selfScene = this.self.scene;\r\n        this.Besom = this.selfScene.getChildByName('Besom');\r\n        this.palm = this.self.getChildByName('palm');\r\n        this.palmLPx = this.palm.transform.localPositionX;\r\n        this.palmLPy = this.palm.transform.localPositionY;\r\n        this.palmLPz = this.palm.transform.localPositionZ;\r\n        this.firstLPx = this.self.transform.localPositionX;\r\n        this.firstLPy = this.self.transform.localPositionY;\r\n        this.firstLPz = this.self.transform.localPositionZ;\r\n        let firstLREx = this.self.transform.localRotationEulerX;\r\n        let firstLREy = this.self.transform.localRotationEulerY;\r\n        let firstLREz = this.self.transform.localRotationEulerZ;\r\n        this.firstLRE = new Laya.Vector3(firstLREx, firstLREy, firstLREz);\r\n        this.lopState = true;\r\n        this.self['UIMain_Hand'] = this;\r\n    }\r\n    firstState() {\r\n        this.self.transform.localPositionX = this.firstLPx;\r\n        this.self.transform.localPositionY = this.firstLPy;\r\n        this.self.transform.localPositionZ = this.firstLPz;\r\n        this.self.transform.localRotationEuler = this.firstLRE;\r\n        let e = this.palm.transform.localRotationEuler.clone();\r\n        e.x = 0;\r\n        e.y = 0;\r\n        e.z = 0;\r\n        this.palm.transform.localRotationEuler = e;\r\n        this.palm.transform.localPositionX = this.palmLPx;\r\n        this.palm.transform.localPositionY = this.palmLPy;\r\n        this.palm.transform.localPositionZ = this.palmLPz;\r\n        this.selfScene['UIMain'].Person['UIMain_Person'].originalState();\r\n        this.lopState = true;\r\n    }\r\n    onTriggerEnter(other) {\r\n        this.handName = this.self.name;\r\n        this.bottomPosition();\r\n        lwg.Global._connectState = true;\r\n        lwg.Global._firstConnect = true;\r\n        console.log(other);\r\n    }\r\n    BesomHandLenCount() {\r\n        let BesomVec = this.Besom.transform.localPosition;\r\n        let handVec = this.self.transform.localPosition;\r\n        let p = new Laya.Vector3();\r\n        Laya.Vector3.subtract(BesomVec, handVec, p);\r\n        let lenp = Laya.Vector3.scalarLength(p);\r\n        return lenp;\r\n    }\r\n    BesomPedestalHandLenCount() {\r\n        let BesomPedestal = this.Besom.getChildByName('pedestal');\r\n        let BesomPedestalVec = BesomPedestal.transform.position;\r\n        let handVec = this.self.transform.position;\r\n        let p = new Laya.Vector3();\r\n        Laya.Vector3.subtract(BesomPedestalVec, handVec, p);\r\n        let lenp = Laya.Vector3.scalarLength(p);\r\n        return lenp;\r\n    }\r\n    bottomPosition() {\r\n        if (!this.BesomHandleLen) {\r\n            return;\r\n        }\r\n        let l_01 = this.BesomHandleLen;\r\n        let l_02 = Math.abs(this.Besom.transform.localPositionY - this.self.transform.localPositionY);\r\n        let l_03;\r\n        if (Math.pow(l_01, 2) - Math.pow(l_02, 2) < 0) {\r\n            l_03 = 0;\r\n        }\r\n        else {\r\n            l_03 = Math.sqrt(Math.pow(l_01, 2) - Math.pow(l_02, 2));\r\n        }\r\n        let BesomBottomX;\r\n        if (this.Besom.transform.localRotationEulerX > 0) {\r\n            BesomBottomX = this.Besom.transform.localPositionX + l_03;\r\n        }\r\n        else {\r\n            BesomBottomX = this.Besom.transform.localPositionX - l_03;\r\n        }\r\n        let offsetX = this.self.transform.localPositionX - BesomBottomX;\r\n        this.Besom.transform.localPositionX += offsetX;\r\n        return offsetX;\r\n    }\r\n    armLookAtHand() {\r\n        let handVec = this.self.transform.position;\r\n        let leftArm = this.selfScene['UIMain'].Person['UIMain_Person'].leftArm;\r\n        if (this.self.name === 'leftHand') {\r\n            leftArm.transform.lookAt(handVec, new Laya.Vector3(0, 1, 0));\r\n            this.armDirection(leftArm);\r\n            let armVec = leftArm.transform.position;\r\n            this.palm.transform.lookAt(armVec, new Laya.Vector3(0, 1, 0));\r\n            this.palmDirection();\r\n            this.handDistance(armVec, handVec);\r\n        }\r\n        let rightArm = this.selfScene['UIMain'].Person['UIMain_Person'].rightArm;\r\n        if (this.self.name === 'rightHand') {\r\n            rightArm.transform.lookAt(handVec, new Laya.Vector3(0, 1, 0));\r\n            this.armDirection(rightArm);\r\n            let armVec = rightArm.transform.position;\r\n            this.palm.transform.lookAt(armVec, new Laya.Vector3(0, 1, 0));\r\n            this.palmDirection();\r\n            this.handDistance(armVec, handVec);\r\n        }\r\n    }\r\n    armDirection(arm) {\r\n        let e = arm.transform.localRotationEuler.clone();\r\n        let x = e.x;\r\n        let y = e.y;\r\n        let z = e.z;\r\n        if (arm.name === 'rightArm') {\r\n            e.x = x + 85;\r\n            e.y = y + 19;\r\n            e.z = z + 30;\r\n        }\r\n        else {\r\n            e.x = x + 85;\r\n            e.y = y - 15;\r\n            e.z = z - 26;\r\n        }\r\n        arm.transform.localRotationEuler = e;\r\n    }\r\n    palmDirection() {\r\n        let e = this.palm.transform.localRotationEuler.clone();\r\n        let x = e.x;\r\n        let y = e.y;\r\n        let z = e.z;\r\n        if (this.self.name === 'rightHand') {\r\n            e.x = x + 90;\r\n            e.y = y;\r\n            e.z = z - 160;\r\n        }\r\n        else {\r\n            e.x = x + 90;\r\n            e.y = y;\r\n            e.z = z + 168;\r\n        }\r\n        this.palm.transform.localRotationEuler = e;\r\n    }\r\n    handDistance(armVec, handVec) {\r\n        let p = new Laya.Vector3();\r\n        Laya.Vector3.subtract(handVec, armVec, p);\r\n        let lenP = Laya.Vector3.scalarLength(p);\r\n        let normalizP = new Laya.Vector3();\r\n        Laya.Vector3.normalize(p, normalizP);\r\n        if (lenP > this.longest) {\r\n            let x = armVec.x + normalizP.x * this.longest;\r\n            let y = armVec.y + normalizP.y * this.longest;\r\n            let z = armVec.z + normalizP.z * this.longest;\r\n            this.self.transform.position.x = x;\r\n            this.self.transform.position.y = y;\r\n        }\r\n        let moveL;\r\n        moveL = (lenP / this.longest) * (this.longest - this.shortest);\r\n        if (this.self.name === 'rightHand') {\r\n            let rightUnder = this.selfScene['UIMain'].Person['UIMain_Person'].rightUnder;\r\n            let rightUnderArmY = this.selfScene['UIMain'].Person['UIMain_Person'].rightUnderArmY;\r\n            let rightUnderArmX = this.selfScene['UIMain'].Person['UIMain_Person'].rightUnderArmX;\r\n            rightUnder.transform.localPositionY = rightUnderArmY - moveL * 40;\r\n            rightUnder.transform.localPositionX = rightUnderArmX - 1.5;\r\n        }\r\n        else {\r\n            let leftUnder = this.selfScene['UIMain'].Person['UIMain_Person'].leftUnder;\r\n            let leftUnderArmY = this.selfScene['UIMain'].Person['UIMain_Person'].leftUnderArmY;\r\n            let leftUnderArmX = this.selfScene['UIMain'].Person['UIMain_Person'].leftUnderArmX;\r\n            leftUnder.transform.localPositionY = leftUnderArmY - moveL * 40;\r\n            leftUnder.transform.localPositionX = leftUnderArmX + 1.5;\r\n        }\r\n    }\r\n    onUpdate() {\r\n        if (!this.lopState) {\r\n            this.armLookAtHand();\r\n        }\r\n        let diffX = this.self.transform.position.x - this.Besom.transform.position.x;\r\n        let diffY = this.self.transform.position.y - this.Besom.transform.position.y;\r\n        if (Math.abs(diffX) < 0.09 && Math.abs(diffY) < 0.01) {\r\n            if (lwg.Global._besomRotate === lwg.Enum.BesomRotateType.static) {\r\n                let random = Math.floor(Math.random() * 2);\r\n                random === 0 ? lwg.Global._besomRotate = lwg.Enum.BesomRotateType.left : lwg.Global._besomRotate = lwg.Enum.BesomRotateType.right;\r\n                this.Besom['UIMain_Besom'].timeAdd = 0;\r\n                this.Besom['UIMain_Besom'].rotateAcc = 0;\r\n            }\r\n            lwg.Global._besomMove = lwg.Enum.BesomMoveType.connectStatic;\r\n            lwg.Global._firstConnect = true;\r\n            this.Besom['UIMain_Besom'].downAccelerated = 0;\r\n            if (lwg.Global._taskPreTopYNum === 1) {\r\n                lwg.Global._taskPreTopYNum = 2;\r\n                console.log(lwg.Global._taskPreTopYNum);\r\n            }\r\n        }\r\n    }\r\n    onDisable() {\r\n    }\r\n}\r\n",
  "references": [
    "D:/Game/project/SetBroom/Setbroom/src/script/Game/UIMain_Person.ts",
    "D:/Game/project/SetBroom/Setbroom/src/script/Lwg_Template/lwg.ts"
  ]
}
