{
  "code": "import UIMain_Person from './UIMain_Person';\r\nimport UIMain_Besom from './UIMain_Besom';\r\nimport UIMain_Hand from './UIMain_Hand';\r\nimport { lwg } from '../Lwg_Template/lwg';\r\nexport default class UIMain extends Laya.Script3D {\r\n    constructor() {\r\n        super();\r\n        this.outs = new Array();\r\n        this.moveSwitch = false;\r\n    }\r\n    ;\r\n    ;\r\n    ;\r\n    ;\r\n    ;\r\n    ;\r\n    ;\r\n    ;\r\n    onEnable() {\r\n        this.GameScene = this.owner;\r\n        this.GameScene['UIMain'] = this;\r\n        this.Camera = this.GameScene.getChildAt(0);\r\n        this.PersonParent = this.GameScene.getChildByName('PersonParent');\r\n        this.Person_xiaofu = this.PersonParent.getChildByName('01_xiaofu');\r\n        this.Person_konglong = this.PersonParent.getChildByName('02_konglong');\r\n        this.Person_xueren = this.PersonParent.getChildByName('03_xueren');\r\n        this.Person_qipao = this.PersonParent.getChildByName('04_qipao');\r\n        this.Person_qianxun = this.PersonParent.getChildByName('05_qianxun');\r\n        this.Person_lvyifu = this.PersonParent.getChildByName('06_lvyifu');\r\n        this.Person_maozi = this.PersonParent.getChildByName('07_maozi');\r\n        this.Person_lufei = this.PersonParent.getChildByName('08_lufei');\r\n        this.Person_chaoren = this.PersonParent.getChildByName('09_chaoren');\r\n        this.currentPifuSet();\r\n        this.Besom = this.GameScene.getChildByName('Besom');\r\n        this.Besom.addComponent(UIMain_Besom);\r\n        this.BesomRig = this.Besom.getComponent(Laya.Rigidbody3D);\r\n        lwg.Global._besomMove = lwg.Enum.BesomMoveType.static;\r\n        this.GoldParent = this.GameScene.getChildByName('GoldParent');\r\n        this.goldTem = this.GoldParent.getChildByName('goldTem');\r\n        this.goldTem.removeSelf();\r\n        this._ray = new Laya.Ray(new Laya.Vector3(0, 0, 0), new Laya.Vector3(0, 0, 0));\r\n        this.addMouseEvent();\r\n        this.targetHand = null;\r\n    }\r\n    currentPifuSet() {\r\n        this.PersonParent.removeChildren(0, this.PersonParent.numChildren - 1);\r\n        console.log(lwg.Global._currentPifu);\r\n        switch (lwg.Global._currentPifu) {\r\n            case '01_xiaofu':\r\n                this.PersonParent.addChild(this.Person_xiaofu.clone());\r\n                break;\r\n            case '02_konglong':\r\n                this.PersonParent.addChild(this.Person_konglong.clone());\r\n                break;\r\n            case '03_xueren':\r\n                this.PersonParent.addChild(this.Person_xueren.clone());\r\n                break;\r\n            case '04_qipao':\r\n                this.PersonParent.addChild(this.Person_qipao.clone());\r\n                break;\r\n            case '05_qianxun':\r\n                this.PersonParent.addChild(this.Person_qianxun.clone());\r\n                break;\r\n            case '06_lvyifu':\r\n                this.PersonParent.addChild(this.Person_lvyifu.clone());\r\n                break;\r\n            case '07_maozi':\r\n                this.PersonParent.addChild(this.Person_maozi.clone());\r\n                break;\r\n            case '08_lufei':\r\n                this.PersonParent.addChild(this.Person_lufei.clone());\r\n                break;\r\n            case '09_chaoren':\r\n                this.PersonParent.addChild(this.Person_chaoren.clone());\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        console.log(this.PersonParent.getChildAt(0));\r\n        this.Person = this.PersonParent.getChildAt(0);\r\n        let scriptPerson = this.Person.getComponent(UIMain_Person);\r\n        if (!scriptPerson) {\r\n            this.Person.addComponent(UIMain_Person);\r\n        }\r\n        this.rightHand = this.Person.getChildByName('rightHand');\r\n        let scriptRightHand = this.rightHand.getComponent(UIMain_Hand);\r\n        if (!scriptRightHand) {\r\n            this.rightHand.addComponent(UIMain_Hand);\r\n        }\r\n        this.leftHand = this.Person.getChildByName('leftHand');\r\n        let scriptLeftHand = this.leftHand.getComponent(UIMain_Hand);\r\n        if (!scriptLeftHand) {\r\n            this.leftHand.addComponent(UIMain_Hand);\r\n        }\r\n    }\r\n    addMouseEvent() {\r\n        Laya.stage.on(Laya.Event.MOUSE_DOWN, this, this.onMouseDown);\r\n        Laya.stage.on(Laya.Event.MOUSE_MOVE, this, this.onMouseMove);\r\n        Laya.stage.on(Laya.Event.MOUSE_UP, this, this.onMouseUp);\r\n        Laya.stage.on(Laya.Event.MOUSE_OUT, this, this.onMouseOut);\r\n    }\r\n    onMouseDown() {\r\n        if (!lwg.Global._gameStart) {\r\n            return;\r\n        }\r\n        lwg.Global._timeLineSwitch = true;\r\n        if (lwg.Global._clickScreenNum === 0) {\r\n            lwg.Global._besomMove = lwg.Enum.BesomMoveType.down;\r\n        }\r\n        lwg.Global._clickScreenNum++;\r\n        this.firstX = Laya.MouseManager.instance.mouseX;\r\n        this.firstY = Laya.MouseManager.instance.mouseY;\r\n        this.Camera.viewportPointToRay(new Laya.Vector2(this.firstX, this.firstY), this._ray);\r\n        this.GameScene.physicsSimulation.rayCastAll(this._ray, this.outs);\r\n        if (this.outs.length != 0) {\r\n            for (var i = 0; i < this.outs.length; i++) {\r\n                let hitResult = this.outs[i].collider.owner;\r\n                if (hitResult.name === 'screen') {\r\n                    this.moveSwitch = true;\r\n                    let stageWidth = Laya.stage.width;\r\n                    if (this.firstX > stageWidth / 2) {\r\n                        this.targetHand = this.rightHand;\r\n                        this.leftHand['UIMain_Hand'].firstState();\r\n                    }\r\n                    else {\r\n                        this.targetHand = this.leftHand;\r\n                        this.rightHand['UIMain_Hand'].firstState();\r\n                    }\r\n                    this.targetHand.transform.position = this.outs[i].point;\r\n                    this.targetHand['UIMain_Hand'].armLookAtHand();\r\n                    this.targetHand['UIMain_Hand'].lopState = false;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    onMouseMove() {\r\n        if (!this.moveSwitch) {\r\n            return;\r\n        }\r\n        let x = Laya.MouseManager.instance.mouseX;\r\n        let y = Laya.MouseManager.instance.mouseY;\r\n        let differenceX;\r\n        let differenceY;\r\n        if (this.firstX && this.firstY) {\r\n            differenceX = this.firstX - x;\r\n            differenceY = this.firstY - y;\r\n        }\r\n        else {\r\n            this.firstX = Laya.MouseManager.instance.mouseX;\r\n            this.firstY = Laya.MouseManager.instance.mouseY;\r\n            return;\r\n        }\r\n        let moveX = differenceX / 900;\r\n        let moveY = differenceY / 900;\r\n        this.firstX = x;\r\n        this.firstY = y;\r\n        let handPosition = new Laya.Vector3(moveX, moveY, 0);\r\n        this.targetHand.transform.translate(handPosition, false);\r\n        if (moveY < -0.03 && lwg.Global._besomMove === lwg.Enum.BesomMoveType.connectStatic) {\r\n            lwg.Global._besomMove = lwg.Enum.BesomMoveType.down;\r\n            this.Besom['UIMain_Besom'].downAccelerated = 0;\r\n        }\r\n        if (moveY > 0.03 && lwg.Global._besomMove === lwg.Enum.BesomMoveType.connectStatic) {\r\n            console.log('颠起！');\r\n            this.Besom.transform.position.y += 5;\r\n            lwg.Global._besomMove = lwg.Enum.BesomMoveType.up;\r\n            let increment;\r\n            if (moveY - 0.03 > 0.03) {\r\n                increment = 0.03;\r\n            }\r\n            else {\r\n                increment = moveY - 0.03;\r\n            }\r\n            this.Besom['UIMain_Besom'].upAccelerated = 0.08 + increment;\r\n        }\r\n        if (lwg.Global._besomMove === lwg.Enum.BesomMoveType.up || lwg.Global._besomMove === lwg.Enum.BesomMoveType.down) {\r\n            lwg.Global._besomRotate = lwg.Enum.BesomRotateType.inSky;\r\n        }\r\n        else {\r\n            if (moveX > 0.005) {\r\n                lwg.Global._besomRotate = lwg.Enum.BesomRotateType.left;\r\n                this.Besom['UIMain_Besom'].timeAdd = 0;\r\n                this.Besom['UIMain_Besom'].rotateAcc_01 = 0.4 + moveX * 30;\r\n                this.Besom['UIMain_Besom'].rotateAcc_02 = 0;\r\n            }\r\n            if (moveX < -0.005) {\r\n                lwg.Global._besomRotate = lwg.Enum.BesomRotateType.right;\r\n                this.Besom['UIMain_Besom'].timeAdd = 0;\r\n                this.Besom['UIMain_Besom'].rotateAcc_01 = -0.4 + moveX * 30;\r\n                this.Besom['UIMain_Besom'].rotateAcc_02 = 0;\r\n            }\r\n            if (moveX === 0) {\r\n                lwg.Global._besomRotate = lwg.Enum.BesomRotateType.connectStatic;\r\n                let rotate = this.Besom.transform.localRotationEulerZ;\r\n                if (rotate > 0) {\r\n                    this.Besom['UIMain_Besom'].rotateAcc_02 = -0.8;\r\n                }\r\n                else if (rotate <= 0) {\r\n                    this.Besom['UIMain_Besom'].rotateAcc_02 = 0.8;\r\n                }\r\n                this.Besom['UIMain_Besom'].rotateAcc_02 = 0;\r\n            }\r\n        }\r\n    }\r\n    onMouseUp() {\r\n        this.moveSwitch = false;\r\n        lwg.Global._besomRotate = lwg.Enum.BesomRotateType.connectStatic;\r\n        this.Besom['UIMain_Besom'].rotateAcc = 0.1;\r\n    }\r\n    onMouseOut() {\r\n        this.moveSwitch = false;\r\n        lwg.Global._besomRotate = lwg.Enum.BesomRotateType.connectStatic;\r\n        this.Besom['UIMain_Besom'].rotateAcc = 0.1;\r\n    }\r\n    taskcheck() {\r\n        let type = lwg.Global._taskPreType;\r\n        switch (type) {\r\n            case lwg.Enum.TaskType.continue:\r\n                if (lwg.Global._gameTimeLine % 60 == 0) {\r\n                    lwg.Global._taskPreTime = Number(lwg.Global._taskPreTime.substring(0, lwg.Global._taskPreTime.length - 1)) - 1 + 's';\r\n                    if (lwg.Global._taskPreTime === '0s') {\r\n                        console.log('坚持时间任务完成!');\r\n                        this.taskSwitch();\r\n                    }\r\n                }\r\n                break;\r\n            case lwg.Enum.TaskType.topUp:\r\n                let pedestalP = this.Besom.getChildAt(2).transform.position;\r\n                let pedestalPY = lwg.Tools.transitionScreenPointfor3D(pedestalP, this.Camera).y;\r\n                if (pedestalPY < lwg.Global._taskPreTopY) {\r\n                    lwg.Global._taskPreTopYNum = 1;\r\n                    console.log('颠起高度达到了！，接到才算胜利');\r\n                }\r\n                if (lwg.Global._taskPreTopYNum === 2) {\r\n                    console.log('颠起任务完成！');\r\n                    this.taskSwitch();\r\n                }\r\n                break;\r\n            case lwg.Enum.TaskType.move:\r\n                let BesomHeadP = this.Besom.getChildAt(0).transform.position;\r\n                let BesomHeadScreenP = lwg.Tools.transitionScreenPointfor3D(BesomHeadP, this.Camera);\r\n                let difX = BesomHeadScreenP.x - lwg.Global._taskPrePoint.x;\r\n                let difY = BesomHeadScreenP.y - lwg.Global._taskPrePoint.y;\r\n                let CountDown = lwg.Global.UITask['UITask'].CountDown;\r\n                let drawPie = lwg.Global.UITask['UITask'].drawPie;\r\n                if (Math.abs(difX) < 80 && Math.abs(difY) < 80) {\r\n                    if (drawPie) {\r\n                        if (drawPie.endAngle <= 0) {\r\n                            this.taskSwitch();\r\n                            CountDown.removeSelf();\r\n                            console.log('移动任务完成！');\r\n                        }\r\n                        else {\r\n                            CountDown.cacheAs = \"none\";\r\n                            drawPie.endAngle -= 4;\r\n                            CountDown.cacheAs = \"bitmap\";\r\n                            if (drawPie.endAngle < 0) {\r\n                                drawPie.endAngle = 0;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    CountDown.cacheAs = \"none\";\r\n                    drawPie.endAngle = 360;\r\n                    CountDown.cacheAs = \"bitmap\";\r\n                }\r\n                break;\r\n            case lwg.Enum.TaskType.gold:\r\n                if (lwg.Global._gameTimeLine % 60 === 0) {\r\n                    lwg.Global._taskPreTime = Number(lwg.Global._taskPreTime.substring(0, lwg.Global._taskPreTime.length - 1)) - 1 + 's';\r\n                    if (lwg.Global._taskPreTime === '0s' || this.GoldParent['_children'].length === 0) {\r\n                        console.log('吃金币任务完成！');\r\n                        this.taskSwitch();\r\n                    }\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    taskSwitch() {\r\n        lwg.Global._taskPreNum += 1;\r\n        let sum = lwg.Global._taskContentArray.length;\r\n        let num = lwg.Global._taskPreNum;\r\n        if (num > sum) {\r\n            let level = lwg.Global._gameLevel;\r\n            if (lwg.Global._taskGoldBoo) {\r\n                this.GoldParent.removeChildren(0, this.GoldParent['_children'].length - 1);\r\n            }\r\n            this.defeatedDecide();\r\n            lwg.Global._openInterface('UIVictory', null, null);\r\n        }\r\n        else {\r\n            lwg.Global.UITask['UITask'].sontentSet();\r\n        }\r\n    }\r\n    defeatedDecide() {\r\n        this.moveSwitch = false;\r\n        this.targetHand = null;\r\n        lwg.Global._gameStart = false;\r\n        lwg.Global._timeLineSwitch = false;\r\n        lwg.Global._gameTimeLine = 0;\r\n        lwg.Global._firstConnect = false;\r\n    }\r\n    onUpdate() {\r\n        if (!lwg.Global._gameStart && !lwg.Global._timeLineSwitch) {\r\n            return;\r\n        }\r\n        if (lwg.Global._gameTimeLine === 0) {\r\n            lwg.Global._clickScreenNum = 0;\r\n            lwg.Global._firstConnect = false;\r\n            lwg.Global._besomMove = lwg.Enum.BesomMoveType.static;\r\n            lwg.Global._besomRotate = lwg.Enum.BesomRotateType.static;\r\n            lwg.Global._openInterface('UITask', null, null);\r\n            this.Besom['UIMain_Besom'].initProperty();\r\n        }\r\n        lwg.Global._gameTimeLine++;\r\n        if (lwg.Global._firstConnect) {\r\n            this.taskcheck();\r\n        }\r\n        let absZ = Math.abs(this.Besom.transform.localRotationEulerZ);\r\n        let posY = this.Besom.transform.localPositionY;\r\n        if (posY < -3.8 || absZ > 80) {\r\n            if (lwg.Global._taskGoldBoo) {\r\n                this.Besom['UIMain_Besom'].initProperty();\r\n            }\r\n            else {\r\n                this.defeatedDecide();\r\n                lwg.Global._openInterface('UIDefeated', null, null);\r\n            }\r\n        }\r\n    }\r\n    onDisable() {\r\n    }\r\n}\r\n",
  "references": [
    "D:/Game/project/SetBroom/Setbroom/src/script/Game/UIMain_Person.ts",
    "D:/Game/project/SetBroom/Setbroom/src/script/Game/UIMain_Besom.ts",
    "D:/Game/project/SetBroom/Setbroom/src/script/Game/UIMain_Hand.ts",
    "D:/Game/project/SetBroom/Setbroom/src/script/Game/UIMain_Gold.ts",
    "D:/Game/project/SetBroom/Setbroom/src/script/Lwg_Template/lwg.ts"
  ]
}
